<!DOCTYPE html>
<html>
<head>
    <title>FinanceTracker Pro</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; background-color: #f0f2f5; color: #333; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { color: #1a73e8; text-align: center; margin-bottom: 30px; }
        
        /* Summary Card */
        .summary-card { background: #e8f0fe; padding: 20px; border-radius: 12px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #d2e3fc; }
        .summary-label { font-weight: 600; color: #1967d2; font-size: 18px; }
        .summary-value { font-size: 28px; font-weight: 800; color: #1a73e8; }

        /* Form Styling */
        .form-group { display: flex; gap: 12px; margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 10px; }
        input { padding: 12px; border: 1px solid #ced4da; border-radius: 8px; flex: 1; font-size: 14px; }
        input:focus { outline: none; border-color: #1a73e8; box-shadow: 0 0 0 2px rgba(26,115,232,0.2); }
        
        /* Buttons */
        button { padding: 12px 24px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; }
        button:hover { background: #1557b0; transform: translateY(-1px); }
        .delete-btn { background: #feeef0; color: #d93025; padding: 6px 12px; font-size: 13px; border: 1px solid #fad2cf; }
        .delete-btn:hover { background: #d93025; color: white; }

        /* Table Styling */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #eee; color: #5f6368; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 15px; }
        
        /* Category Badge */
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; color: white; text-transform: capitalize; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š FinanceTracker Pro</h1>
        
        <div class="summary-card">
            <span class="summary-label">Total Expenses</span>
            <span id="totalDisplay" class="summary-value">$0.00</span>
        </div>

        <div class="form-group">
            <input type="text" id="item" placeholder="What did you buy?">
            <input type="number" id="amount" placeholder="Amount">
            <input type="text" id="category" placeholder="Category (e.g. Food)">
            <button onclick="addExpense()">Add Expense</button>
        </div>

        <table id="expenseTable">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Amount</th>
                    <th>Category</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000/expenses/';

        // Helper function for Category Colors
        function getCategoryColor(cat) {
            const colors = {
                'food': '#f4b400',     // Yellow
                'rent': '#4285f4',     // Blue
                'shopping': '#af5cf7', // Purple
                'bills': '#db4437',    // Red
                'transport': '#0f9d58' // Green
            };
            return colors[cat.toLowerCase()] || '#5f6368'; // Default Gray
        }

        // 1. GET DATA & UPDATE UI
        async function loadExpenses() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                const body = document.getElementById('tableBody');
                const totalDisplay = document.getElementById('totalDisplay');

                // Handle Empty State
                if (data.length === 0) {
                    body.innerHTML = `<tr><td colspan="4" style="text-align:center; padding:40px; color:#999;">No expenses yet. Add your first one above!</td></tr>`;
                    totalDisplay.innerText = "$0.00";
                    return;
                }

                // Calculate Total
                const total = data.reduce((sum, ex) => sum + parseFloat(ex.amount), 0);
                totalDisplay.innerText = `$${total.toFixed(2)}`;

                // Build Table Rows
                body.innerHTML = data.map(ex => `
                    <tr>
                        <td style="font-weight:500;">${ex.item}</td>
                        <td style="color:#1a73e8; font-weight:bold;">$${parseFloat(ex.amount).toFixed(2)}</td>
                        <td><span class="badge" style="background:${getCategoryColor(ex.category)}">${ex.category}</span></td>
                        <td>
                            <button class="delete-btn" onclick="deleteExpense(${ex.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error("Backend not running?", err);
            }
        }

        // 2. POST DATA
        async function addExpense() {
            const item = document.getElementById('item').value;
            const amount = document.getElementById('amount').value;
            const category = document.getElementById('category').value;

            if (!item || !amount) return alert("Please enter item and amount");

            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ item, amount, category: category || 'General' })
            });
            
            // Clear inputs
            document.getElementById('item').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('category').value = '';

            loadExpenses(); 
        }

        // 3. DELETE DATA
        async function deleteExpense(id) {
            if (confirm("Delete this expense?")) {
                await fetch(`${API_URL}${id}`, { method: 'DELETE' });
                loadExpenses();
            }
        }

        loadExpenses();
    </script>
</body>
</html>
